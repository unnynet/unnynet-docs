# Окружение

У каждой игры 3 окружения: Development, Stage и Production. Это стандартный и часто используемый подход.

1. **Development** используется в процессе разработки. Здесь создаются все новые функции, исправляются ошибки.
2. **Stage** может быть пропущен инди-разработчиками. Обычно его используют крупные компании, у которых есть собственный QA-отдел. Это окружение используется для тестирования всех функций, созданных ранее. Отдельное окружение для тестирования полезно, потому что не требует остановки команды разработчиков.
3. **Production** использует реальными игроками.


### Рабочие процесс

1. Новые функции разрабатываются и сбалансированы в **Development**.
2. Когда вы будете готовы, откройте раздел «Environment» и перенесите данные из окружения **Development** в **Stage**.
3. В процессе сотрутся все данные в ** Stage **, и скопирует все из **Development**.
4. Передайте сборку, работающую с окружением **Stage **, вашему QA.
5. После того, как QA одобрит сборку, перенесите данные из **Stage** в **Production** и опубликуйте свою сборку игры (работающую с окружением **Production**) в магазинах.

### Смена окружения

Вам следует избегать изменения окружения в DE. В лучшем случае вам просто нужно поработать в **Development**, а затем перенести данные в другие окружения. UnnyNet даже не поддерживает передачу данных среды в обратном направлении.

Однако бывают ситуации, когда вам может потребоваться что-то изменить сразу в **Production**.

Допустим, вы уже опубликовали свою игру, и ваши пользователи играют в окружении **Production**. Затем вы обнаруживаете ошибку в балансе, которую хотите исправить как можно скорее. Ваша команда уже подготовила массу изменений в **Development**, поэтому вы не можете перенести все в **Production** без обновления сборки. Можно просто переключаться в **Production** в DE, исправить баланс и развернуть изменения. Вот и всё! Только не забудьте потом внести эти же изменения в **Development**.

### Миграция данных

В разделе Environment вы можете перенести свои данные:

1. С **Development** в **Stage**.
2. С **Stage** в **Production**.

Когда вы начинаете процесс миграции, происходит много вещей. Например, когда вы переносите данные из Dev в Stage, под капотом происходит:
1.  [Публикация](/data_editor/deploy) вызывается для окружения **Development**.
2.  Все данные переносятся с **Dev** на **Stage**, перезаписав всё, что было до этого в **Stage**.
3.  [Публикация](/data_editor/deploy) вызывается для **Stage**.

Это означает, что если вы хотите отправить все данные из **Dev** в **Prod**, вам просто нужно передать данные из **Dev** в **Stage**, а затем в **Prod**. После этого вам не нужно ничего публиковать. Это уже было сделано во время миграции.

### Как подключить нужное окружение

Мы обычно используем [Define Symbols](https://docs.unity3d.com/Manual/PlatformDependentCompilation.html) для указания окружения:

```csharp fct_label="Unity"
UnnyNet.Main.Init(new AppConfig
{
    ApiGameId = <API_GAME_ID>,
    PublicKey = <PUBLIC_KEY>,
    OnReadyCallback = response =>
    {
        if (!response.Success)
            Debug.LogError("Couldn't initialize UnnyNet");
    },
    Environment = GetEnvironment()
});
            
public static UnnyNet.Constants.Environment GetEnvironment()
{
#if SERVER_PROD
    return UnnyNet.Constants.Environment.Production;
#elif SERVER_STAGE
    return UnnyNet.Constants.Environment.Stage;
#else
    return UnnyNet.Constants.Environment.Development;
#endif
}
```

Затем вам просто нужно переключать дефайны между **SERVER_DEV**, **SERVER_STAGE** и **SERVER_PROD** перед запуском игры в Unity или создания сборки.
Конечно, вы можете захотеть изменить среду во время выполнения для целей тестирования. Просто будьте осторожны и не позволяйте конечным пользователям подключаться к среде, отличной от **Production**. 